# uv_work

## ğŸ“… ëª©ì°¨

- [2025-09-04](#2025-09-04)
  
<br><br><br>

---

## 2025-09-04

### LangGraph + RAG ì—ì´ì „íŠ¸ êµ¬ì¡°

---

#### ğŸ”¹ 1. ìƒíƒœ ì •ì˜ (`AgentState`)

```python
class AgentState(TypedDict):
    query: str            # ì‚¬ìš©ìì˜ ì§ˆë¬¸
    context: List[Document]  # ê²€ìƒ‰ëœ ê´€ë ¨ ë¬¸ì„œ
    answer: str           # ìµœì¢… ìƒì„± ë‹µë³€
```

* ìƒíƒœì—ëŠ” ì§ˆë¬¸, ë¬¸ì„œ, ë‹µë³€ì´ í¬í•¨ë¨
* ê° ë…¸ë“œì—ì„œ ìƒíƒœë¥¼ ì…ë ¥ë°›ì•„ ì²˜ë¦¬ í›„ ì—…ë°ì´íŠ¸

---

#### ğŸ”¹ 2. ë…¸ë“œ(Node) ì •ì˜

1. **retrieve**

   * ë²¡í„° DB(Chroma)ì—ì„œ ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë¬¸ì„œ ê²€ìƒ‰
   * ë°˜í™˜: `{'context': docs}`
2. **check\_doc\_relevence**

   * ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì§ˆë¬¸ê³¼ ê´€ë ¨ ìˆëŠ”ì§€ íŒë‹¨
   * ë°˜í™˜: `'generate'` ë˜ëŠ” `'rewrite'`
3. **generate**

   * RAG ì²´ì¸ì„ í†µí•´ ì§ˆë¬¸+ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ ìƒì„±
   * ë°˜í™˜: `{'answer': response}`
4. **rewrite**

   * ì§ˆë¬¸ì„ ì‚¬ì „ì— ì •ì˜ëœ ê·œì¹™/ì‚¬ì „ì„ ì°¸ê³ í•´ ìˆ˜ì •
   * ë°˜í™˜: `{'query': rewritten_query}`

---

#### ğŸ”¹ 3. ì¡°ê±´ë¶€ ì—£ì§€(Conditional Edge)

* **retrieve â†’ generate / rewrite** ë¡œ ë¶„ê¸°

```python
builder.add_conditional_edges('retrieve', check_doc_relevence)
```

* ê´€ë ¨ ë¬¸ì„œê°€ ìˆìœ¼ë©´ â†’ `generate`
* ê´€ë ¨ ë¬¸ì„œê°€ ë¶€ì¡±í•˜ë©´ â†’ `rewrite` â†’ ë‹¤ì‹œ `retrieve`

---

#### ğŸ”¹ 4. ê·¸ë˜í”„ ì—°ê²°

```python
builder.add_edge(START, 'retrieve')
builder.add_edge('rewrite', 'retrieve')
builder.add_edge('generate', END)
```

* START â†’ retrieve â†’ (ì¡°ê±´ë¶€) generate/rewrite â†’ END
* ë¬¸ì„œ ê´€ë ¨ì„±ì´ ë‚®ìœ¼ë©´ rewriteë¥¼ ê±°ì³ retrieveë¥¼ ë‹¤ì‹œ ì‹¤í–‰

---

#### ğŸ”¹ 5. ê·¸ë˜í”„ ì‹¤í–‰

```python
initial_state = {"query": "ì—°ë´‰ 5ì²œë§Œì› ì§ì¥ì¸ì˜ ì†Œë“ì„¸ëŠ”?"}
response = graph.invoke(initial_state)
print(response['answer'].content)
```

* ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ë©´, LangGraphê°€ **RAG ê¸°ë°˜ ê²€ìƒ‰ â†’ ê´€ë ¨ì„± ì²´í¬ â†’ í•„ìš” ì‹œ ì§ˆë¬¸ ì¬ì‘ì„± â†’ ë‹µë³€ ìƒì„±** íë¦„ì„ ì²˜ë¦¬
* ìƒíƒœ(State)ê°€ ê·¸ë˜í”„ ì „ì²´ì—ì„œ ê³„ì† ìœ ì§€ë˜ë¯€ë¡œ ë¶„ê¸°ì™€ ë°˜ë³µ ì²˜ë¦¬ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ê°€ëŠ¥

---

#### ğŸ”¹ 6. í•µì‹¬ í¬ì¸íŠ¸

1. **StateGraph**: ìƒíƒœ(State)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤í–‰ íë¦„ ì •ì˜
2. **Node**: ê¸°ëŠ¥ ë‹¨ìœ„(ê²€ìƒ‰, ìƒì„±, ì¬ì‘ì„±)
3. **Conditional Edge**: ë¬¸ì„œ ê´€ë ¨ì„±ì— ë”°ë¼ ë¶„ê¸° ê²°ì •
4. **RAG ì²´ì¸ + LLM**: ë¬¸ì„œë¥¼ í™œìš©í•œ ë‹µë³€ ìƒì„±
5. **ì¬ì‹¤í–‰ êµ¬ì¡°**: rewrite í›„ ë‹¤ì‹œ retrieve ê°€ëŠ¥ â†’ ìœ ì—°í•œ ì§ˆë¬¸ ì²˜ë¦¬

---

ğŸ“…[ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨)

---
ê·¸ë¦¼ìœ¼ë¡œ ë³´ë©´ í›¨ì”¬ ì§ê´€ì ì…ë‹ˆë‹¤. ì›í•´?
