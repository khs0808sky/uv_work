# uv_work

## ğŸ“… ëª©ì°¨

- [2025-09-04](#2025-09-04)
- [2025-09-05](#2025-09-05)
  
<br><br><br>

---

## 2025-09-04

### LangGraph + RAG ì—ì´ì „íŠ¸ êµ¬ì¡°

---

#### ğŸ”¹ 1. ìƒíƒœ ì •ì˜ (`AgentState`)

```python
class AgentState(TypedDict):
    query: str            # ì‚¬ìš©ìì˜ ì§ˆë¬¸
    context: List[Document]  # ê²€ìƒ‰ëœ ê´€ë ¨ ë¬¸ì„œ
    answer: str           # ìµœì¢… ìƒì„± ë‹µë³€
```

* ìƒíƒœì—ëŠ” ì§ˆë¬¸, ë¬¸ì„œ, ë‹µë³€ì´ í¬í•¨ë¨
* ê° ë…¸ë“œì—ì„œ ìƒíƒœë¥¼ ì…ë ¥ë°›ì•„ ì²˜ë¦¬ í›„ ì—…ë°ì´íŠ¸

---

#### ğŸ”¹ 2. ë…¸ë“œ(Node) ì •ì˜

1. **retrieve**

   * ë²¡í„° DB(Chroma)ì—ì„œ ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë¬¸ì„œ ê²€ìƒ‰
   * ë°˜í™˜: `{'context': docs}`
2. **check\_doc\_relevence**

   * ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì§ˆë¬¸ê³¼ ê´€ë ¨ ìˆëŠ”ì§€ íŒë‹¨
   * ë°˜í™˜: `'generate'` ë˜ëŠ” `'rewrite'`
3. **generate**

   * RAG ì²´ì¸ì„ í†µí•´ ì§ˆë¬¸+ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ ìƒì„±
   * ë°˜í™˜: `{'answer': response}`
4. **rewrite**

   * ì§ˆë¬¸ì„ ì‚¬ì „ì— ì •ì˜ëœ ê·œì¹™/ì‚¬ì „ì„ ì°¸ê³ í•´ ìˆ˜ì •
   * ë°˜í™˜: `{'query': rewritten_query}`

---

#### ğŸ”¹ 3. ì¡°ê±´ë¶€ ì—£ì§€(Conditional Edge)

* **retrieve â†’ generate / rewrite** ë¡œ ë¶„ê¸°

```python
builder.add_conditional_edges('retrieve', check_doc_relevence)
```

* ê´€ë ¨ ë¬¸ì„œê°€ ìˆìœ¼ë©´ â†’ `generate`
* ê´€ë ¨ ë¬¸ì„œê°€ ë¶€ì¡±í•˜ë©´ â†’ `rewrite` â†’ ë‹¤ì‹œ `retrieve`

---

#### ğŸ”¹ 4. ê·¸ë˜í”„ ì—°ê²°

```python
builder.add_edge(START, 'retrieve')
builder.add_edge('rewrite', 'retrieve')
builder.add_edge('generate', END)
```

* START â†’ retrieve â†’ (ì¡°ê±´ë¶€) generate/rewrite â†’ END
* ë¬¸ì„œ ê´€ë ¨ì„±ì´ ë‚®ìœ¼ë©´ rewriteë¥¼ ê±°ì³ retrieveë¥¼ ë‹¤ì‹œ ì‹¤í–‰

---

#### ğŸ”¹ 5. ê·¸ë˜í”„ ì‹¤í–‰

```python
initial_state = {"query": "ì—°ë´‰ 5ì²œë§Œì› ì§ì¥ì¸ì˜ ì†Œë“ì„¸ëŠ”?"}
response = graph.invoke(initial_state)
print(response['answer'].content)
```

* ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ë©´, LangGraphê°€ **RAG ê¸°ë°˜ ê²€ìƒ‰ â†’ ê´€ë ¨ì„± ì²´í¬ â†’ í•„ìš” ì‹œ ì§ˆë¬¸ ì¬ì‘ì„± â†’ ë‹µë³€ ìƒì„±** íë¦„ì„ ì²˜ë¦¬
* ìƒíƒœ(State)ê°€ ê·¸ë˜í”„ ì „ì²´ì—ì„œ ê³„ì† ìœ ì§€ë˜ë¯€ë¡œ ë¶„ê¸°ì™€ ë°˜ë³µ ì²˜ë¦¬ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ê°€ëŠ¥

---

#### ğŸ”¹ 6. í•µì‹¬ í¬ì¸íŠ¸

1. **StateGraph**: ìƒíƒœ(State)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤í–‰ íë¦„ ì •ì˜
2. **Node**: ê¸°ëŠ¥ ë‹¨ìœ„(ê²€ìƒ‰, ìƒì„±, ì¬ì‘ì„±)
3. **Conditional Edge**: ë¬¸ì„œ ê´€ë ¨ì„±ì— ë”°ë¼ ë¶„ê¸° ê²°ì •
4. **RAG ì²´ì¸ + LLM**: ë¬¸ì„œë¥¼ í™œìš©í•œ ë‹µë³€ ìƒì„±
5. **ì¬ì‹¤í–‰ êµ¬ì¡°**: rewrite í›„ ë‹¤ì‹œ retrieve ê°€ëŠ¥ â†’ ìœ ì—°í•œ ì§ˆë¬¸ ì²˜ë¦¬

---

ğŸ“…[ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨)

---

## 2025-09-05

### LangGraph: ìƒíƒœ ê´€ë¦¬ (State Management)

LangGraphì—ì„œ \*\*ìƒíƒœ(State)\*\*ëŠ” ê·¸ë˜í”„ ì‹¤í–‰ ì „ì²´ë¥¼ ê´€í†µí•˜ë©° ë…¸ë“œ ê°„ ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” í•µì‹¬ êµ¬ì¡°ì…ë‹ˆë‹¤.
ìƒíƒœ ê´€ë¦¬ê°€ ì˜ ë˜ì–´ì•¼ ë³µì¡í•œ RAGÂ·ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë„ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆì–´ìš”.

---

#### ğŸ”¹ ìƒíƒœ(State)ì˜ ê°œë…

* \*\*í˜„ì¬ ê·¸ë˜í”„ ì‹¤í–‰ì˜ ë§¥ë½(Context)\*\*ì„ ì €ì¥í•˜ëŠ” **ë°ì´í„° ì»¨í…Œì´ë„ˆ**
* `TypedDict`ë‚˜ Pydantic ëª¨ë¸ ë“±ìœ¼ë¡œ ì •ì˜
* ê° ë…¸ë“œê°€ ì…ë ¥ë°›ê³ , ì²˜ë¦¬í•œ ê°’ì„ ë‹¤ì‹œ ìƒíƒœì— ì—…ë°ì´íŠ¸
* ì˜ˆì‹œ:

  ```python
  from typing import List, TypedDict
  from langchain_core.documents import Document

  class AgentState(TypedDict):
      query: str
      context: List[Document]
      answer: str
  ```

---

#### ğŸ”¹ ìƒíƒœ(State) ê´€ë¦¬ ë°©ì‹

1. **Immutable Update**

   * ë…¸ë“œ í•¨ìˆ˜ê°€ ìƒíƒœë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ì§€ ì•Šê³ , **ìƒˆë¡œìš´ dictë¥¼ ë°˜í™˜**
   * ê° ë…¸ë“œê°€ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ê°€/ê°±ì‹ 

   ```python
   def retrieve(state: AgentState) -> AgentState:
       docs = retriever.invoke(state['query'])
       return {"context": docs}
   ```

   * ì´ë ‡ê²Œ í•˜ë©´ ìƒíƒœì˜ ì¶”ì ì´ ì‰¬ì›€

2. **ì „ì²´ ìƒíƒœ ë³‘í•©(Merge)**

   * LangGraphëŠ” ë…¸ë“œ ë°˜í™˜ê°’ì„ ê¸°ì¡´ ìƒíƒœì™€ ë³‘í•©
   * `state.update(node_return)` ìë™ ì²˜ë¦¬
   * ì´ ë•ë¶„ì— í•„ìš”í•œ ê°’ë§Œ ë°˜í™˜í•´ë„ ìƒíƒœê°€ ìœ ì§€ë¨

3. **ë‹¨ì¼ ì§„ì…ì  â†’ ë‹¨ì¼ ì¢…ë£Œì **

   * ê·¸ë˜í”„ ì‹œì‘ ì‹œ `initial_state`ë¥¼ ì œê³µ
   * END ë…¸ë“œê¹Œì§€ ìƒíƒœë¥¼ ëˆ„ì í•´ ìµœì¢… ê²°ê³¼ í™•ì¸ ê°€ëŠ¥

---

#### ğŸ”¹ ìƒíƒœ ê´€ë¦¬ì˜ ì¥ì 

* ë³µì¡í•œ ë¶„ê¸°/ë£¨í”„ì—ì„œë„ **ì¤‘ê°„ ê²°ê³¼ ìœ ì§€**
* LLM í˜¸ì¶œ, ê²€ìƒ‰ ê²°ê³¼, ë©”íƒ€ë°ì´í„° ë“±ì„ í•œ ê°ì²´ì—ì„œ ê´€ë¦¬
* ë””ë²„ê¹…ê³¼ ë¡œê¹…ì´ ìš©ì´ (ìƒíƒœë§Œ ì°ìœ¼ë©´ ì „ì²´ ë§¥ë½ íŒŒì•… ê°€ëŠ¥)

---

### LangGraph: ë¼ìš°íŒ… ë…¸ë“œ(Routing Node)ì™€ í•¨ìˆ˜(Function) ë¶„ë¦¬

LangGraphì—ì„œëŠ” **ë¡œì§ì„ ë¼ìš°íŒ… í•¨ìˆ˜ë¡œ ë¶„ë¦¬**í•´ íë¦„ì„ ëª…í™•í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆì–´ìš”.

---

#### ğŸ”¹ ë¼ìš°íŒ… ë…¸ë“œ ê°œë…

* **ì‹¤ì œ ë°ì´í„°ë¥¼ ìƒì„±/ê°€ê³µí•˜ì§€ ì•Šê³ **, ë‹¨ìˆœíˆ **ë‹¤ìŒìœ¼ë¡œ ì´ë™í•  ë…¸ë“œ ì´ë¦„ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜**ì™€ ì—°ê²°ëœ ë…¸ë“œ
* ì˜ˆ: ì§ˆë¬¸ì˜ ì˜ë„ ë¶„ì„ í›„ "ê²€ìƒ‰ ë…¸ë“œ" ë˜ëŠ” "ìš”ì•½ ë…¸ë“œ"ë¡œ ì´ë™

---

#### ğŸ”¹ ë¼ìš°íŒ… í•¨ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ

```python
def route(state: AgentState) -> str:
    # ì§ˆë¬¸ì´ "ë‚ ì”¨" ê´€ë ¨ì´ë©´ weather_nodeë¡œ ì´ë™
    if "ë‚ ì”¨" in state["query"]:
        return "weather_node"
    return "default_node"

builder.add_conditional_edges("router_node", route)
```

---

#### ğŸ”¹ í•¨ìˆ˜ì™€ ë…¸ë“œ ë¶„ë¦¬ì˜ ì´ì 

1. **ì±…ì„ ë¶„ë¦¬ (Separation of Concerns)**

   * ë¡œì§ íŒë‹¨(`route`)ê³¼ ë°ì´í„° ì²˜ë¦¬(`generate`, `retrieve`)ê°€ ë¶„ë¦¬ë˜ì–´ ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›€
2. **ê·¸ë˜í”„ êµ¬ì¡°ê°€ ëª…í™•í•´ì§**

   * ê° ë…¸ë“œì˜ ì—­í• ì´ ë‹¨ìˆœí™” â†’ ë””ë²„ê¹…, ì¬ì‚¬ìš©ì„± â†‘
3. **í™•ì¥ì„± ë†’ìŒ**

   * ìƒˆë¡œìš´ ë¶„ê¸° ë¡œì§ ì¶”ê°€ ì‹œ ë¼ìš°í„° í•¨ìˆ˜ë§Œ ìˆ˜ì •í•˜ë©´ ë¨

---

#### ğŸ”¹ ì •ë¦¬ëœ ê·¸ë˜í”„ íŒ¨í„´

```
START â†’ router_node â†’ { weather_node | default_node } â†’ END
```

* `router_node`ëŠ” ìƒíƒœë§Œ ë³´ê³  ê²½ë¡œ ê²°ì •
* ì‹¤ì œ ë°ì´í„° ìƒì„±ì€ `weather_node` ë“±ì—ì„œ ìˆ˜í–‰

---

ğŸ“…[ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨)

---


